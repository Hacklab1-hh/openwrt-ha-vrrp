
<%+header%>
<h2><%:HA VRRP â€” Logs%></h2>
<div class="cbi-section">
  <label><%:Lines%>:</label>
  <input type="number" id="lines" value="200" min="10" max="2000" step="10"/>
  <button class="btn cbi-button" onclick="fetchLog()"><%:Refresh%></button>
  <pre id="log_out" style="max-height:480px;overflow:auto;"></pre>
</div>
<script>
function fetchLog(){
  var n = document.getElementById("lines").value || 200;
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "<%=luci.dispatcher.build_url('admin','services','ha_vrrp','action')%>", true);
  xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
  xhr.onreadystatechange = function(){
    if (xhr.readyState === 4){
      var box = document.getElementById("log_out");
      try {
        var j = JSON.parse(xhr.responseText);
        if(!j.ok){ box.textContent = "error: " + (j.error||"unknown"); return; }
        box.textContent = j.output || "";
      } catch(e) { box.textContent = xhr.responseText; }
    }
  };
  xhr.send("cmd=" + encodeURIComponent("log-tail:" + n));
}
fetchLog();
</script>
<%+footer%>
